/*
 * Copyright 2018-2020 Cloudera, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
*/

plugins {
    id 'application'
}

application {
    mainClassName = 'com.hortonworks.registries.webservice.RegistryApplication'
}

configurations {
    testImplementation {
        exclude group: 'org.slf4j', module: 'slf4j-simple'
    }
}

dependencies {

    implementation(project(':registry-common')) { transitive = false }
    implementation project(':registry-common-client')
    implementation(project(':registry-webservice')) {
        exclude group: 'com.sun.jersey.contribs', module: 'jersey-guice'
    }
    implementation project(':schema-registry:schema-registry-authorizer')
    implementation project(':schema-registry:schema-registry-common')
    implementation project(':schema-registry:schema-registry-core')
    implementation project(':schema-registry:oauth2-authenticator')
    implementation project(':schema-registry:ssl-authenticator')
    implementation project(':atlas-integration:atlas-common')
    implementation project(':atlas-integration:atlas-module')
    implementation project(':storage:storage-core')
    implementation(project(':common-auth')) {
        exclude group: 'javax.servlet', module: 'servlet-api'
    }

    implementation libraries.hibernate_validator
    implementation libraries.el_api
    implementation libraries.jetty
    implementation libraries.guice

    implementation libraries.dropwizard.core
    implementation libraries.dropwizard.swagger
    implementation libraries.dropwizard.assets
    implementation libraries.dropwizard.auth
    implementation libraries.dropwizard.metrics
    implementation libraries.dropwizard.guicey

    implementation libraries.swagger

    implementation libraries.guava
    implementation libraries.commons.lang3
    implementation libraries.commons.io
    implementation libraries.commons.collections
    implementation libraries.nimbus
    implementation libraries.jersey.media_multipart

    testImplementation(libraries.jackson.scala_module) { exclude group: 'org.scala-lang' }

    testImplementation group: 'junit', name: 'junit', version: '4.13.2'
    testImplementation group: 'org.scala-lang', name: 'scala-library', version: scala_version
    testImplementation group: 'org.scala-lang', name: 'scala-reflect', version: scala_version

    testImplementation (libraries.kafka.confluent_avro_serializer) {
        constraints {
            testImplementation(libraries.kafka.clients) {
                force = true
            }
        }
    }
    testImplementation (libraries.kafka.confluent_sr_client) {
        constraints {
            testImplementation(libraries.kafka.clients) {
                force = true
            }
        }
    }

    testImplementation(project(path: ':schema-registry:schema-registry-client')) { transitive = false }
    testImplementation(project(path: ':schema-registry:schema-registry-serdes')) { transitive = false }
    testImplementation(project(path: ':schema-registry:jersey-shaded', configuration: 'shadow'))

    testImplementation libraries.junit
    testImplementation libraries.mockito
    testImplementation libraries.dropwizard.testing

    testImplementation libraries.kafka.clients
    testImplementation libraries.kafka.test.clients
    testImplementation libraries.kafka.test.streams
    testImplementation libraries.kafka.test.streams_test_utils

    testImplementation(libraries.kafka.test.core) { exclude group: 'org.scala-lang' }
    testImplementation(libraries.kafka.core) { exclude group: 'org.scala-lang' }

    testImplementation libraries.logging.slf4j_simple
    testImplementation libraries.httpclient.client

    runtimeOnly group: 'mysql', name: 'mysql-connector-java', version: '5.1.48'
//    runtimeOnly group: 'com.oracle.database.jdbc', name: 'ojdbc8', version: '12.2.0.1'
}

jar {
    manifest {
        attributes(
                "Main-Class": application.mainClass,
                "Implementation-Title": project.name,
                "Implementation-Version": project.version
        )
    }
}